# just using interface, and we don't really expect them to use it on 2.x so just skip diffing
#spark2-sql-plugin/src/main/java/com/nvidia/spark/RapidsUDF.java

diff ./sql-plugin/src/main/scala/org/apache/spark/sql/hive/rapids/GpuHiveOverrides.scala spark2-sql-plugin/src/main/scala/org/apache/spark/sql/hive/rapids/GpuHiveOverrides.scala > GpuHiveOverrides.newdiff
if [[ $(diff spark2diffs/GpuHiveOverrides.diff GpuHiveOverrides.newdiff) ]]; then
  echo "check diff for spark2-sql-plugin/src/main/scala/org/apache/spark/sql/hive/rapids/GpuHiveOverrides.scala"
fi

sed -n  '/class GpuBroadcastNestedLoopJoinMeta/,/override def convertToGpu/{/override def convertToGpu/!p}' spark2-sql-plugin/src/main/scala/org/apache/spark/sql/rapids/execution/GpuBroadcastNestedLoopJoinMeta.scala > GpuBroadcastNestedLoopJoinMeta_new.out
sed -n  '/class GpuBroadcastNestedLoopJoinMeta/,/override def convertToGpu/{/override def convertToGpu/!p}' sql-plugin/src/main/scala/org/apache/spark/sql/rapids/execution/GpuBroadcastNestedLoopJoinExec.scala > GpuBroadcastNestedLoopJoinMeta_old.out
diff GpuBroadcastNestedLoopJoinMeta_new.out GpuBroadcastNestedLoopJoinMeta_old.out >  GpuBroadcastNestedLoopJoinMeta.newdiff
diff -c spark2diffs/GpuBroadcastNestedLoopJoinMeta.diff  GpuBroadcastNestedLoopJoinMeta.newdiff

sed -n  '/object JoinTypeChecks/,/def extractTopLevelAttributes/{/def extractTopLevelAttributes/!p}' spark2-sql-plugin/src/main/scala/org/apache/spark/sql/rapids/execution/GpuHashJoin.scala > GpuHashJoin_new.out
sed -n  '/object JoinTypeChecks/,/def extractTopLevelAttributes/{/def extractTopLevelAttributes/!p}' ./sql-plugin/src/main/scala/org/apache/spark/sql/rapids/execution/GpuHashJoin.scala > GpuHashJoin_old.out
diff GpuHashJoin_new.out GpuHashJoin_old.out > GpuHashJoin.newdiff
diff -c spark2diffs/GpuHashJoin.diff GpuHashJoin.newdiff

sed -n  '/class GpuShuffleMeta/,/override def convertToGpu/{/override def convertToGpu/!p}' spark2-sql-plugin/src/main/scala/org/apache/spark/sql/rapids/execution/GpuShuffleMeta.scala > GpuShuffleMeta_new.out
sed -n  '/class GpuShuffleMeta/,/override def convertToGpu/{/override def convertToGpu/!p}' sql-plugin/src/main/scala/org/apache/spark/sql/rapids/execution/GpuShuffleExchangeExecBase.scala > GpuShuffleMeta_old.out
diff GpuShuffleMeta_new.out GpuShuffleMeta_old.out > GpuShuffleMeta.newdiff
diff -c spark2diffs/GpuShuffleMeta.diff GpuShuffleMeta.newdiff

sed -n  '/class GpuBroadcastMeta/,/override def convertToGpu/{/override def convertToGpu/!p}' spark2-sql-plugin/src/main/scala/org/apache/spark/sql/rapids/execution/GpuBroadcastExchangeExecMeta.scala > GpuBroadcastExchangeExecMeta_new.out
sed -n  '/class GpuBroadcastMeta/,/override def convertToGpu/{/override def convertToGpu/!p}' sql-plugin/src/main/scala/org/apache/spark/sql/rapids/execution/GpuBroadcastExchangeExec.scala > GpuBroadcastExchangeExecMeta_old.out
diff GpuBroadcastExchangeExecMeta_new.out GpuBroadcastExchangeExecMeta_old.out > GpuBroadcastExchangeExecMeta.newdiff
diff -c spark2diffs/GpuBroadcastExchangeExecMeta.diff GpuBroadcastExchangeExecMeta.newdiff


sed -n  '/abstract class UnixTimeExprMeta/,/sealed trait TimeParserPolicy/{/sealed trait TimeParserPolicy/!p}' spark2-sql-plugin/src/main/scala/org/apache/spark/sql/rapids/datetimeExpressionsMeta.scala > UnixTimeExprMeta_new.out
sed -n  '/abstract class UnixTimeExprMeta/,/sealed trait TimeParserPolicy/{/sealed trait TimeParserPolicy/!p}' sql-plugin/src/main/scala/org/apache/spark/sql/rapids/datetimeExpressions.scala > UnixTimeExprMeta_old.out
diff UnixTimeExprMeta_new.out UnixTimeExprMeta_old.out > UnixTimeExprMeta.newdiff
diff -c spark2diffs/UnixTimeExprMeta.diff UnixTimeExprMeta.newdiff

sed -n  '/object GpuToTimestamp/,/abstract class UnixTimeExprMeta/{/abstract class UnixTimeExprMeta/!p}' spark2-sql-plugin/src/main/scala/org/apache/spark/sql/rapids/datetimeExpressionsMeta.scala > GpuToTimestamp_new.out
sed -n  '/object GpuToTimestamp/,/val REMOVE_WHITESPACE_FROM_MONTH_DAY/{/val REMOVE_WHITESPACE_FROM_MONTH_DAY/!p}' sql-plugin/src/main/scala/org/apache/spark/sql/rapids/datetimeExpressions.scala > GpuToTimestamp_old.out
diff GpuToTimestamp_new.out GpuToTimestamp_old.out > GpuToTimestamp.newdiff
diff -c spark2diffs/GpuToTimestamp.diff GpuToTimestamp.newdiff

sed -n  '/case class ParseFormatMeta/,/case class RegexReplace/p' spark2-sql-plugin/src/main/scala/org/apache/spark/sql/rapids/datetimeExpressionsMeta.scala > datemisc_new.out
sed -n  '/case class ParseFormatMeta/,/case class RegexReplace/p' sql-plugin/src/main/scala/org/apache/spark/sql/rapids/datetimeExpressions.scala > datemisc_old.out
diff -c datemisc_new.out datemisc_old.out

sed -n  '/class GpuRLikeMeta/,/^}/{/^}/!p}' spark2-sql-plugin/src/main/scala/org/apache/spark/sql/rapids/stringMeta.scala > GpuRLikeMeta_new.out
sed -n  '/class GpuRLikeMeta/,/override def convertToGpu/{/override def convertToGpu/!p}' sql-plugin/src/main/scala/org/apache/spark/sql/rapids/stringFunctions.scala > GpuRLikeMeta_old.out
diff GpuRLikeMeta_new.out GpuRLikeMeta_old.out > GpuRLikeMeta.newdiff
diff -c spark2diffs/GpuRLikeMeta.diff  GpuRLikeMeta.newdiff

sed -n  '/class GpuRegExpExtractMeta/,/^}/{/^}/!p}' spark2-sql-plugin/src/main/scala/org/apache/spark/sql/rapids/stringMeta.scala > GpuRegExpExtractMeta_new.out
sed -n  '/class GpuRegExpExtractMeta/,/override def convertToGpu/{/override def convertToGpu/!p}' sql-plugin/src/main/scala/org/apache/spark/sql/rapids/stringFunctions.scala > GpuRegExpExtractMeta_old.out
diff GpuRegExpExtractMeta_new.out GpuRegExpExtractMeta_old.out > GpuRegExpExtractMeta.newdiff
diff -c spark2diffs/GpuRegExpExtractMeta.diff  GpuRegExpExtractMeta.newdiff

sed -n  '/class SubstringIndexMeta/,/^}/{/^}/!p}' spark2-sql-plugin/src/main/scala/org/apache/spark/sql/rapids/stringMeta.scala > SubstringIndexMeta_new.out
sed -n  '/class SubstringIndexMeta/,/override def convertToGpu/{/override def convertToGpu/!p}' sql-plugin/src/main/scala/org/apache/spark/sql/rapids/stringFunctions.scala > SubstringIndexMeta_old.out
diff SubstringIndexMeta_new.out SubstringIndexMeta_old.out > SubstringIndexMeta.newdiff
diff -c spark2diffs/SubstringIndexMeta.diff  SubstringIndexMeta.newdiff

sed -n  '/object CudfRegexp/,/^}/{/^}/!p}' spark2-sql-plugin/src/main/scala/org/apache/spark/sql/rapids/stringMeta.scala > CudfRegexp_new.out
sed -n  '/object CudfRegexp/,/^}/{/^}/!p}' sql-plugin/src/main/scala/org/apache/spark/sql/rapids/stringFunctions.scala > CudfRegexp_old.out
diff -c CudfRegexp_new.out CudfRegexp_old.out > CudfRegexp.newdiff

sed -n  '/object GpuSubstringIndex/,/^}/{/^}/!p}' spark2-sql-plugin/src/main/scala/org/apache/spark/sql/rapids/stringMeta.scala > GpuSubstringIndex_new.out
sed -n  '/object GpuSubstringIndex/,/^}/{/^}/!p}' sql-plugin/src/main/scala/org/apache/spark/sql/rapids/stringFunctions.scala > GpuSubstringIndex_old.out
diff -c GpuSubstringIndex_new.out GpuSubstringIndex_old.out > GpuSubstringIndex.newdiff

sed -n  '/class GpuStringSplitMeta/,/^}/{/^}/!p}' spark2-sql-plugin/src/main/scala/org/apache/spark/sql/rapids/stringMeta.scala > GpuStringSplitMeta_new.out
sed -n  '/class GpuStringSplitMeta/,/override def convertToGpu/{/override def convertToGpu/!p}' sql-plugin/src/main/scala/org/apache/spark/sql/rapids/stringFunctions.scala > GpuStringSplitMeta_old.out
diff GpuStringSplitMeta_new.out GpuStringSplitMeta_old.out > GpuStringSplitMeta.newdiff
diff -c spark2diffs/GpuStringSplitMeta.diff  GpuStringSplitMeta.newdiff

sed -n  '/object GpuOrcFileFormat/,/^}/{/^}/!p}' spark2-sql-plugin/src/main/scala/org/apache/spark/sql/rapids/GpuOrcFileFormat.scala > GpuOrcFileFormat_new.out
sed -n  '/object GpuOrcFileFormat/,/^}/{/^}/!p}' sql-plugin/src/main/scala/org/apache/spark/sql/rapids/GpuOrcFileFormat.scala  > GpuOrcFileFormat_old.out
diff  GpuOrcFileFormat_new.out GpuOrcFileFormat_old.out > GpuOrcFileFormat.newdiff
diff -c spark2diffs/GpuOrcFileFormat.diff GpuOrcFileFormat.newdiff


sed -n  '/class GpuSequenceMeta/,/^}/{/^}/!p}' spark2-sql-plugin/src/main/scala/org/apache/spark/sql/rapids/collectionOperations.scala > GpuSequenceMeta_new.out
sed -n  '/class GpuSequenceMeta/,/override def convertToGpu/{/override def convertToGpu/!p}' sql-plugin/src/main/scala/org/apache/spark/sql/rapids/collectionOperations.scala > GpuSequenceMeta_old.out
diff GpuSequenceMeta_new.out GpuSequenceMeta_old.out > GpuSequenceMeta.newdiff
diff -c spark2diffs/GpuSequenceMeta.diff  GpuSequenceMeta.newdiff

sed -n  '/object GpuDataSource/,/^}/{/^}/!p}' spark2-sql-plugin/src/main/scala/org/apache/spark/sql/rapids/GpuDataSource.scala > GpuDataSource_new.out
sed -n  '/object GpuDataSource/,/val GLOB_PATHS_KEY/{/val GLOB_PATHS_KEY/!p}' sql-plugin/src/main/scala/org/apache/spark/sql/rapids/GpuDataSource.scala > GpuDataSource_old.out
diff  GpuDataSource_new.out GpuDataSource_old.out > GpuDataSource.newdiff
diff -c spark2diffs/GpuDataSource.diff GpuDataSource.newdiff

sed -n  '/class GpuGetArrayItemMeta/,/^}/{/^}/!p}' spark2-sql-plugin/src/main/scala/org/apache/spark/sql/rapids/complexTypeExtractors.scala  > GpuGetArrayItemMeta_new.out
sed -n  '/class GpuGetArrayItemMeta/,/override def convertToGpu/{/override def convertToGpu/!p}' sql-plugin/src/main/scala/org/apache/spark/sql/rapids/complexTypeExtractors.scala > GpuGetArrayItemMeta_old.out
diff GpuGetArrayItemMeta_new.out GpuGetArrayItemMeta_old.out > GpuGetArrayItemMeta.newdiff
diff -c spark2diffs/GpuGetArrayItemMeta.diff  GpuGetArrayItemMeta.newdiff

sed -n  '/class GpuGetMapValueMeta/,/^}/{/^}/!p}' spark2-sql-plugin/src/main/scala/org/apache/spark/sql/rapids/complexTypeExtractors.scala  > GpuGetMapValueMeta_new.out
sed -n  '/class GpuGetMapValueMeta/,/override def convertToGpu/{/override def convertToGpu/!p}' sql-plugin/src/main/scala/org/apache/spark/sql/rapids/complexTypeExtractors.scala > GpuGetMapValueMeta_old.out
diff GpuGetMapValueMeta_new.out GpuGetMapValueMeta_old.out > GpuGetMapValueMeta.newdiff
diff -c spark2diffs/GpuGetMapValueMeta.diff  GpuGetMapValueMeta.newdiff

sed -n  '/abstract class ScalaUDFMetaBase/,/^}/{/^}/!p}' spark2-sql-plugin/src/main/scala/org/apache/spark/sql/rapids/GpuScalaUDFMeta.scala> ScalaUDFMetaBase_new.out
sed -n  '/abstract class ScalaUDFMetaBase/,/override def convertToGpu/{/override def convertToGpu/!p}' sql-plugin/src/main/scala/org/apache/spark/sql/rapids/GpuScalaUDF.scala > ScalaUDFMetaBase_old.out
diff ScalaUDFMetaBase_new.out ScalaUDFMetaBase_old.out > ScalaUDFMetaBase.newdiff
diff -c spark2diffs/ScalaUDFMetaBase.diff  ScalaUDFMetaBase.newdiff

sed -n  '/object GpuScalaUDF/,/^}/{/^}/!p}' spark2-sql-plugin/src/main/scala/org/apache/spark/sql/rapids/GpuScalaUDFMeta.scala > GpuScalaUDF_new.out
sed -n  '/object GpuScalaUDF/,/^}/{/^}/!p}' sql-plugin/src/main/scala/org/apache/spark/sql/rapids/GpuScalaUDF.scala > GpuScalaUDF_old.out
diff  -c GpuScalaUDF_new.out GpuScalaUDF_old.out > GpuScalaUDF.newdiff


sed -n  '/object GpuDecimalMultiply/,/^}/{/^}/!p}' spark2-sql-plugin/src/main/scala/org/apache/spark/sql/rapids/arithmetic.scala > GpuDecimalMultiply_new.out
sed -n  '/object GpuDecimalMultiply/,/def checkForOverflow/{/def checkForOverflow/!p}' sql-plugin/src/main/scala/org/apache/spark/sql/rapids/arithmetic.scala > GpuDecimalMultiply_old.out
diff  GpuDecimalMultiply_new.out GpuDecimalMultiply_old.out > GpuDecimalMultiply.newdiff
diff -c spark2diffs/GpuDecimalMultiply.diff GpuDecimalMultiply.newdiff

sed -n  '/object GpuDecimalDivide/,/^}/{/^}/!p}' spark2-sql-plugin/src/main/scala/org/apache/spark/sql/rapids/arithmetic.scala > GpuDecimalDivide_new.out
sed -n  '/object GpuDecimalDivide/,/^}/{/^}/!p}' sql-plugin/src/main/scala/org/apache/spark/sql/rapids/arithmetic.scala > GpuDecimalDivide_old.out
diff  GpuDecimalDivide_new.out GpuDecimalDivide_old.out > GpuDecimalDivide.newdiff
diff -c spark2diffs/GpuDecimalDivide.diff GpuDecimalDivide.newdiff

sed -n  '/def isSupportedRelation/,/^  }/{/^  }/!p}' spark2-sql-plugin/src/main/scala/org/apache/spark/TrampolineUtil.scala > isSupportedRelation_new.out
sed -n  '/def isSupportedRelation/,/^  }/{/^  }/!p}' sql-plugin/src/main/scala/org/apache/spark/sql/rapids/execution/TrampolineUtil.scala > isSupportedRelation_old.out
diff  -c isSupportedRelation_new.out isSupportedRelation_old.out 

sed -n  '/def dataTypeExistsRecursively/,/^  }/{/^  }/!p}' spark2-sql-plugin/src/main/scala/org/apache/spark/TrampolineUtil.scala > dataTypeExistsRecursively_new.out
sed -n  '/def dataTypeExistsRecursively/,/^  }/{/^  }/!p}' sql-plugin/src/main/scala/org/apache/spark/sql/rapids/execution/TrampolineUtil.scala > dataTypeExistsRecursively_old.out
diff  -c dataTypeExistsRecursively_new.out dataTypeExistsRecursively_old.out 

sed -n  '/def getSimpleName/,/^  }/{/^  }/!p}' spark2-sql-plugin/src/main/scala/org/apache/spark/TrampolineUtil.scala > getSimpleName_new.out
sed -n  '/def getSimpleName/,/^  }/{/^  }/!p}' sql-plugin/src/main/scala/org/apache/spark/sql/rapids/execution/TrampolineUtil.scala > getSimpleName_old.out
diff  -c getSimpleName_new.out getSimpleName_old.out 


spark2-sql-plugin/src/main/scala/com
spark2-sql-plugin/src/main/scala/com/nvidia
spark2-sql-plugin/src/main/scala/com/nvidia/spark
spark2-sql-plugin/src/main/scala/com/nvidia/spark/rapids
spark2-sql-plugin/src/main/scala/com/nvidia/spark/rapids/RegexParser.scala
spark2-sql-plugin/src/main/scala/com/nvidia/spark/rapids/TypeChecks.scala
spark2-sql-plugin/src/main/scala/com/nvidia/spark/rapids/DataTypeUtils.scala
spark2-sql-plugin/src/main/scala/com/nvidia/spark/rapids/GpuOverrides.scala
spark2-sql-plugin/src/main/scala/com/nvidia/spark/rapids/GpuOrcScanBase.scala
spark2-sql-plugin/src/main/scala/com/nvidia/spark/rapids/literalsMeta.scala
spark2-sql-plugin/src/main/scala/com/nvidia/spark/rapids/aggregateMeta.scala
spark2-sql-plugin/src/main/scala/com/nvidia/spark/rapids/GpuGenerateExecMeta.scala
spark2-sql-plugin/src/main/scala/com/nvidia/spark/rapids/ExplainPlan.scala
spark2-sql-plugin/src/main/scala/com/nvidia/spark/rapids/basicPhysicalOperatorsMeta.scala
spark2-sql-plugin/src/main/scala/com/nvidia/spark/rapids/GpuSortExecMeta.scala
spark2-sql-plugin/src/main/scala/com/nvidia/spark/rapids/InputFileBlockRule.scala
spark2-sql-plugin/src/main/scala/com/nvidia/spark/rapids/shims
spark2-sql-plugin/src/main/scala/com/nvidia/spark/rapids/shims/v2
spark2-sql-plugin/src/main/scala/com/nvidia/spark/rapids/shims/v2/gpuPandasMeta.scala
spark2-sql-plugin/src/main/scala/com/nvidia/spark/rapids/shims/v2/GpuShuffledHashJoinExecMeta.scala
spark2-sql-plugin/src/main/scala/com/nvidia/spark/rapids/shims/v2/TreeNode.scala
spark2-sql-plugin/src/main/scala/com/nvidia/spark/rapids/shims/v2/GpuSortMergeJoinMeta.scala
spark2-sql-plugin/src/main/scala/com/nvidia/spark/rapids/shims/v2/GpuJoinUtils.scala
spark2-sql-plugin/src/main/scala/com/nvidia/spark/rapids/shims/v2/TypeSigUtil.scala
spark2-sql-plugin/src/main/scala/com/nvidia/spark/rapids/shims/v2/GpuBroadcastHashJoinExecMeta.scala
spark2-sql-plugin/src/main/scala/com/nvidia/spark/rapids/shims/v2/GpuCSVScan.scala
spark2-sql-plugin/src/main/scala/com/nvidia/spark/rapids/shims/v2/OffsetWindowFunctionMeta.scala
spark2-sql-plugin/src/main/scala/com/nvidia/spark/rapids/shims/v2/GpuRegExpReplaceMeta.scala
spark2-sql-plugin/src/main/scala/com/nvidia/spark/rapids/shims/v2/gpuWindows.scala
spark2-sql-plugin/src/main/scala/com/nvidia/spark/rapids/GpuWindowMeta.scala
spark2-sql-plugin/src/main/scala/com/nvidia/spark/rapids/GpuExpandMeta.scala
spark2-sql-plugin/src/main/scala/com/nvidia/spark/rapids/RapidsMeta.scala
spark2-sql-plugin/src/main/scala/com/nvidia/spark/rapids/GpuReadCSVFileFormat.scala
spark2-sql-plugin/src/main/scala/com/nvidia/spark/rapids/RapidsConf.scala
spark2-sql-plugin/src/main/scala/com/nvidia/spark/rapids/GpuParquetScanBase.scala
spark2-sql-plugin/src/main/scala/com/nvidia/spark/rapids/GpuBroadcastJoinMeta.scala
spark2-sql-plugin/src/main/scala/com/nvidia/spark/rapids/AggregateUtils.scala
spark2-sql-plugin/src/main/scala/com/nvidia/spark/rapids/GpuCastMeta.scala
spark2-sql-plugin/src/main/scala/com/nvidia/spark/rapids/GpuReadOrcFileFormat.scala
spark2-sql-plugin/src/main/scala/com/nvidia/spark/rapids/GpuParquetFileFormat.scala
spark2-sql-plugin/src/main/scala/com/nvidia/spark/rapids/DecimalUtil.scala
spark2-sql-plugin/src/main/scala/com/nvidia/spark/rapids/GpuReplicateRowsMeta.scala
spark2-sql-plugin/src/main/scala/com/nvidia/spark/rapids/DateUtils.scala
